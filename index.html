<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SNIPER V12 REBORN</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <style>
        body { background-color: #0f172a; color: #cbd5e1; font-family: sans-serif; }
        .card { background-color: #1e293b; border: 1px solid #334155; border-radius: 0.75rem; overflow: hidden; }
    </style>
</head>
<body class="p-4 max-w-2xl mx-auto pb-20">
    <header class="flex justify-between items-center mb-6 border-b border-gray-700 pb-4">
        <div>
            <h1 class="text-2xl font-black text-blue-500 italic">SNIPER <span class="text-white text-sm not-italic">V12.5</span></h1>
            <p id="update-time" class="text-[10px] text-gray-500 font-mono mt-1">WAITING FOR DATA...</p>
        </div>
        <div class="text-right">
            <div class="text-sm font-bold text-blue-300">SPY <span id="spy-val">--</span></div>
            <div class="text-sm font-bold text-yellow-500">VIX <span id="vix-val">--</span></div>
        </div>
    </header>

    <div id="report-container" class="space-y-8">
        <div class="text-center text-gray-500 py-10">Loading Intelligence...</div>
    </div>

    <script>
        async function initDashboard() {
            const timeParam = '?t=' + new Date().getTime();
            
            // 1. í—¤ë” ë°ì´í„° ë¡œë“œ
            try {
                const statusRes = await fetch('market_status.json' + timeParam);
                const statusData = await statusRes.json();
                document.getElementById('spy-val').innerText = statusData.spy_price;
                document.getElementById('vix-val').innerText = statusData.vix;
                document.getElementById('update-time').innerText = "UPDATED: " + statusData.last_update + " (KST)";
            } catch(e) { console.log("Header Error"); }

            // 2. V12 ë¦¬í¬íŠ¸ ë¡œë“œ
            try {
                const repRes = await fetch('final_v12_report.json' + timeParam);
                const reports = await repRes.json();
                const container = document.getElementById('report-container');
                container.innerHTML = '';

                reports.forEach((item, index) => {
                    const card = document.createElement('div');
                    card.className = 'card shadow-xl';
                    
                    // ìƒíƒœë³„ ìƒ‰ìƒ ë° ë±ƒì§€
                    let badgeColor = item.status === 'BUY' ? 'bg-red-600 text-white animate-pulse' : 
                                     item.status === 'WATCH' ? 'bg-yellow-600 text-black' : 'bg-gray-600 text-gray-200';
                    
                    const chartId = `tv_chart_${index}`;

                    card.innerHTML = `
                        <div class="p-4 border-b border-gray-700 bg-gray-800/50 flex justify-between items-center">
                            <h2 class="text-xl font-bold text-white tracking-wider">${item.symbol}</h2>
                            <span class="px-2 py-1 text-xs font-bold rounded ${badgeColor}">${item.status}</span>
                        </div>
                        <div class="p-4 space-y-3 text-sm">
                            <div class="flex flex-col">
                                <span class="text-gray-500 text-[10px] uppercase font-bold">ğŸ“‰ Drop Reason</span>
                                <span class="text-red-300 font-semibold">${item.drop_reason}</span>
                            </div>
                            <div class="flex flex-col">
                                <span class="text-gray-500 text-[10px] uppercase font-bold">ğŸ›¡ï¸ Support Level</span>
                                <span class="text-green-400 font-semibold border-b border-green-900/30 pb-1">${item.support_level}</span>
                            </div>
                            <div class="flex flex-col bg-gray-900/50 p-2 rounded">
                                <span class="text-gray-500 text-[10px] uppercase font-bold">ğŸ“° AI Analysis</span>
                                <span class="text-gray-400 leading-snug text-xs">${item.latest_news}</span>
                            </div>
                        </div>
                        <div class="h-64 bg-black" id="${chartId}"></div>
                    `;
                    container.appendChild(card);

                    // ì°¨íŠ¸ ìœ„ì ¯ ìƒì„± (V12 ìŠ¤íƒ€ì¼)
                    new TradingView.widget({
                        "container_id": chartId,
                        "autosize": true,
                        "symbol": item.symbol,
                        "interval": "D",
                        "timezone": "Asia/Seoul",
                        "theme": "dark",
                        "style": "1",
                        "locale": "kr",
                        "toolbar_bg": "#f1f3f6",
                        "enable_publishing": false,
                        "hide_side_toolbar": false,
                        "allow_symbol_change": true,
                        "save_image": false
                    });
                });
            } catch(e) { console.error("Report Error", e); }
        }
        
        initDashboard();
    </script>
</body>
</html>
